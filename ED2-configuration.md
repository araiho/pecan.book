ED2 is configured using 2 files which are placed in the run folder.

* **ED2IN** : template for this file is located at models/ed/inst/ED2IN.\<revision\>. The values in this template that need to be modified are described below and are surrounded with @ symbols.
* **config.xml** : this file is generated by PEcAn. Some values are stored in the pecan.xml in \<pfts\>\<pft\>\<constants\> section as well as in \<model\> section.

## ED2IN configuration variables

**@SITE_LAT@** : site latitude location, from \<run\>\<site\>\<lat\>, used in template for NL%POI_LAT    
**@SITE_LON@** : site longitude location, from \<run\>\<site\>\<lon\>, used in template for NL%POI_LON  

**@SITE_MET@** : met header location, from \<run\>\<site\>\<met\>  
**@MET_START@** : met header location, from \<run\>\<site\>\<met.start\>  
**@MET_END@** : met header location, from \<run\>\<site\>\<met.end\>  

        if(is.null(settings$model$phenol.scheme)){
          print(paste("no phenology scheme set; \n",
                      "need to add <phenol.scheme> tag under <model> tag in settings file"))
        } else if(settings$model$phenol.scheme==1) {
          ## Set prescribed phenology switch in ED2IN
          ed2in.text <- gsub('@PHENOL_SCHEME@', settings$model$phenol.scheme, ed2in.text)
          ## Phenology filename
          ed2in.text <- gsub('@PHENOL@', settings$model$phenol, ed2in.text)
          ## Set start year of phenology
          ed2in.text <- gsub('@PHENOL_START@', settings$model$phenol.start, ed2in.text)
          ## Set end year of phenology
          ed2in.text <- gsub('@PHENOL_END@', settings$model$phenol.end, ed2in.text)

          ## If not prescribed set alternative phenology scheme.
        } else {
          ed2in.text <- gsub(' @PHENOL_SCHEME@', settings$model$phenol.scheme, ed2in.text)
          # Insert blanks into ED2IN file so ED2 runs without error
          ed2in.text <- gsub('@PHENOL@', "", ed2in.text)
          ed2in.text <- gsub('@PHENOL_START@', "", ed2in.text)
          ed2in.text <- gsub('@PHENOL_END@', "", ed2in.text)
        }

        ##----------------------------------------------------------------------
        ed2in.text <- gsub('@SITE_PSSCSS@', settings$model$psscss, ed2in.text)
        ed2in.text <- gsub('@ED_VEG@', settings$model$veg, ed2in.text)
        ed2in.text <- gsub('@ED_SOIL@', settings$model$soil, ed2in.text)
        ed2in.text <- gsub('@ED_INPUTS@', settings$model$inputs, ed2in.text)

        ##----------------------------------------------------------------------
        ed2in.text <- gsub('@START_MONTH@', format(startdate, "%m"), ed2in.text)
        ed2in.text <- gsub('@START_DAY@', format(startdate, "%d"), ed2in.text)
        ed2in.text <- gsub('@START_YEAR@', format(startdate, "%Y"), ed2in.text)
        ed2in.text <- gsub('@END_MONTH@', format(enddate, "%m"), ed2in.text)
        ed2in.text <- gsub('@END_DAY@', format(enddate, "%d"), ed2in.text)
        ed2in.text <- gsub('@END_YEAR@', format(enddate, "%Y"), ed2in.text)

        ##----------------------------------------------------------------------
        ed2in.text <- gsub('@OUTDIR@', settings$run$host$outdir, ed2in.text)
        ed2in.text <- gsub('@ENSNAME@', run.id, ed2in.text)
        ed2in.text <- gsub('@CONFIGFILE@', "config.xml", ed2in.text)

        ## Generate a numbered suffix for scratch output folder.  Useful for cleanup.  TEMP CODE. NEED TO UPDATE.
        ## cnt = counter(cnt) # generate sequential scratch output directory names
        ## print(cnt)
        ## scratch = paste(Sys.getenv("USER"),".",cnt,"/",sep="")
        scratch = paste(Sys.getenv("USER"),"/",settings$run$scratch, sep='')
        ## ed2in.text <- gsub('@SCRATCH@', paste('/scratch/', settings$run$scratch, sep=''), ed2in.text)
        ed2in.text <- gsub('@SCRATCH@', paste('/scratch/', scratch, sep=''), ed2in.text)
        ##

        #  ed2in.text <- gsub('@OUTFILE@', file.path(settings$run$host$outdir, run.id, "analysis"), ed2in.text)
        #  ed2in.text <- gsub('@OUTFILE@', file.path(settings$run$host$outdir, run.id, "analysis"), ed2in.text)

        ed2in.text <- gsub('@FFILOUT@', file.path(settings$run$host$outdir, run.id, "analysis"), ed2in.text)
        ed2in.text <- gsub('@SFILOUT@', file.path(settings$run$host$outdir, run.id, "history"), ed2in.text)
